# verify - Инструмент верификации утверждений

## Обзор

Инструмент `verify` проверяет утверждения пользователя через повторный поиск в базе знаний. Используется агентом для фактчекинга и повышения достоверности ответов.

## Функциональность

### Основные возможности
- **Фактчекинг**: Проверка утверждений через поиск в документах
- **Оценка уверенности**: Вычисление confidence score на основе релевантности
- **Интеграция с поиском**: Использование Retriever для поиска подтверждающих документов
- **Детализированный анализ**: Возврат списка подтверждающих фактов

### Параметры
- `query` (str): Исходный запрос пользователя
- `claim` (str): Утверждение для проверки
- `retriever` (Retriever): Экземпляр ретривера для поиска
- `top_k` (int): Количество документов для поиска (по умолчанию 3)

### Возвращаемые данные
```python
{
    "verified": bool,           # Результат верификации
    "confidence": float,        # Уровень уверенности (0.0-1.0)
    "evidence": List[str],      # Список подтверждающих фактов
    "error": "string"           # Сообщение об ошибке (если есть)
}
```

## Алгоритм работы

1. **Валидация входа**: Проверка наличия утверждения для верификации
2. **Поиск документов**: Выполнение поиска по утверждению в базе знаний
3. **Анализ результатов**: Оценка релевантности найденных документов
4. **Вычисление confidence**: Определение уровня уверенности на основе качества поиска
5. **Формирование ответа**: Структурированный результат верификации

## Интеграция с агентом

Используется в ReAct цикле для:
- Проверки финального ответа перед выдачей пользователю
- Фактчекинга ключевых утверждений в ответе агента
- Повышения качества и достоверности ответов
- Обеспечения соответствия ответа исходным документам

## Обработка ошибок

- Обработка пустых утверждений с возвратом отрицательного результата
- Graceful handling некорректных результатов поиска
- Логирование всех этапов верификации для аудита

## Производительность

- Ограничение количества проверяемых документов (top_k)
- Эффективный поиск только по релевантным утверждениям
- Минимизация нагрузки на систему поиска

## Качество верификации

Алгоритм оценивает:
- **Релевантность документов**: Насколько найденные документы относятся к утверждению
- **Количество подтверждающих фактов**: Сколько документов подтверждают утверждение
- **Качество поиска**: Общий score поиска по утверждению

Результат верификации помогает агенту принимать решения о корректности ответа и необходимости дополнительных поисков.
