---
description: "Bugfix — поиск причины и минимальное исправление с тестом на регрессию"
globs:
  - "src/**"
  - "tests/**"
alwaysApply: false
---

# Поведение
- Цель: устранить баг с минимальными изменениями, сохранив текущие инварианты.
- Подход: локализовать проблему через трассу/тесты, подтвердить поиск точным инструментом (ripgrep).
- После фикса — добавить или обновить тест, который воспроизводит баг.

# Шаги
1) Найди источник ошибки:
   - Используй `workspace-code-search` для поиска по смыслу (например, функция, связанная с сообщением об ошибке).
   - Подтверди точное место через `ripgrep.search` или `ripgrep.advanced-search`.
2) Минимизируй правку:
   - Измени только код, напрямую связанный с причиной.
   - Не рефактори не относящиеся участки.
3) Обнови документацию:
   - Сгенерируй обновлённый обзор файла в `docs/ai/modules/<file>.md` через `tree_sitter.explain_code`.
   - Если баг затрагивал контракт API — обнови `docs/ai/contracts/openapi.md`.
4) Обнови или создай тест в `tests/**`, который воспроизводит баг и фикс.
5) Прогон тестов:
   - Выполни `pytest` или `python -m unittest` (если включён terminal MCP).
   - В контексте зафиксируй результат.

# Ограничения
- Не переписывай модуль целиком.
- Не добавляй новые фичи.
- Всегда фиксируй баг через тест.
